
<link rel="stylesheet" href="styles/logger-styles.css" />

<nav class="site-menu">
  <ul>
    <li><a href="home.html" class="menu-link">Home</a></li>
    <li><a href="about.html" class="menu-link">About</a></li>
    <li><a href="experiment-entry.html" class="menu-link active">Experiments</a></li>
    <li><a href="reflection-entry.html" class="menu-link">Reflections</a></li>
  </ul>
</nav>

<div class="entry-form">
  <h2>Experiment entry</h2>
    <p class="metadata">
      <strong>Entangled Cognition Protocol (ECP) Schema</strong> v0.1
    </p>
    <p>This form is designed to help you log your experiment in a structured and intentional way. Be mindful of the sensory cues as you make your entry. This is a sacred data being co-created. Treat it accordingly.</p>
  <div class="form-navigation">
    <!-- Progress bar or step indicators and navigation buttons will go here -->
  </div>
  <div id="step-nav" class="sticky-nav">
  <div id="step-indicator" style="text-align: center; margin-bottom: 0.5rem;">
    Step 1 of 5: Metadata
  </div>
  <div class="nav-buttons" style="display: flex; justify-content: space-between;">
    <button type="button" class="prev-step-btn">‚Üê Previous</button>
    <button type="button" class="next-step-btn">Next ‚Üí</button>
  </div>
</div>
  <div class="form-step" data-step="1" style="display:block;">
    <fieldset>
      <legend>Metadata</legend>
      <label for="experiment_id">Experiment ID:</label>
      <input type="text" id="experiment_id" placeholder="ecp-2025-06-07-001" required />
      <label for="author">Author:</label>
      <input type="text" id="author" placeholder="anonymous" required />
      <label for="timestamp_start">Start time:</label>
      <input type="datetime-local" id="timestamp_start" required />
      <label for="timestamp_end">End time:</label>
      <input type="datetime-local" id="timestamp_end" />
    </fieldset>
  </div>
  <div class="form-step" data-step="2" style="display:none;">
    <fieldset>
      <legend>Human context</legend>
      <p>These are not exhaustive but are simply a framework for understanding the human context of the experiment.</p>
      <label for="cognitive_mode_input">Cognitive mode:</label>
      <details>
        <summary>View guidance</summary>
        <p>This is about the cognitive style that was most present during the experiment. Like if you were focused, in creative flow, or had a analytical style of thinking. Just add some tags that you sense fit your experience best üòâ</p>
      </details>
      <div class="tag-input-wrapper" id="cognitive_mode">
        <ul class="chip-list">
          <!-- Chips will be inserted here dynamically -->
          <li><input type="text" id="cognitive_mode_input" class="chip-entry-input" placeholder="add tag" /></li>
        </ul>
      </div>

      <label for="ontological_orientation">Ontological orientation:</label>
      <details>
        <summary>View guidance</summary>
        <p>This is about how you perceive the nature of reality, or the predominant beliefs that shape your understanding of existence. A short one or two word tag is sufficient. Don't overthink it!</p>
      </details>
      <div class="tag-input-wrapper" id="ontological_orientation">
        <ul class="chip-list">
          <!-- Chips will be inserted here dynamically -->
          <li><input type="text" id="ontological_orientation_input" class="chip-entry-input" placeholder="add tag" /></li>
        </ul>
      </div>

      <label for="ontological_orientation_description">Ontological Orientation (Short description)</label>
      <textarea id="ontological_orientation_description" rows="4" placeholder="Describe your ontological orientation entering this session..."></textarea>

      <label for="orientation_strength">Orientation strength (1‚Äì10):</label>
      <details>
      <summary>View guidance</summary>
      <p>This is about how strongly you felt aligned with your ontological orientation during the experiment. A simple 1‚Äì10 scale is sufficient. 1 being not aligned at all, and 10 being fully aligned.</p>
      </details>
      <input type="number" id="orientation_strength" min="0" max="10" />

      <label for="affective_tone_input">Affective tone:</label>
      <details>
        <summary>View guidance</summary>
        <p>This is about the emotional state or mood you were in before and during the experiment. You can add tags that describe your emotional state, like "calm", "excited", "anxious", etc.</p>
      </details>
      <div class="tag-input-wrapper" id="affective_tone">
        <ul class="chip-list">
          <li><input type="text" id="affective_tone_input" class="chip-entry-input" placeholder="add tag" /></li>
        </ul>
      </div>
      <br />
      <h3>Ingested substances</h3>
      <p>These are substances that may have influenced your cognitive state and/or ontological orientation during the experiment. Please enter them as a simple none, low, medium, or high.</p>
      <label for="caffeine">Caffeine:</label>
      <select id="caffeine">
        <option value="none">None</option>
        <option value="low">Low</option>
        <option value="medium">Medium</option>
        <option value="high">High</option>
      </select>

      <label for="psilocybin">Psilocybin:</label>
      <select id="psilocybin">
        <option value="none">None</option>
        <option value="low">Low</option>
        <option value="medium">Medium</option>
        <option value="high">High</option>
      </select>

      <label for="alcohol">Alcohol:</label>
      <select id="alcohol">
        <option value="none">None</option>
        <option value="low">Low</option>
        <option value="medium">Medium</option>
        <option value="high">High</option>
      </select>

      <label for="nicotine">Nicotine:</label>
      <select id="nicotine">
        <option value="none">None</option>
        <option value="low">Low</option>
        <option value="medium">Medium</option>
        <option value="high">High</option>
      </select>

      <label for="thc">THC:</label>
      <select id="thc">
        <option value="none">None</option>
        <option value="low">Low</option>
        <option value="medium">Medium</option>
        <option value="high">High</option>
      </select>

      <label for="dmt">DMT:</label>
      <select id="dmt">
        <option value="none">None</option>
        <option value="low">Low</option>
        <option value="medium">Medium</option>
        <option value="high">High</option>
      </select>

      <label for="weather_input">Weather:</label>
      <div class="tag-input-wrapper" id="weather">
        <ul class="chip-list">
          <li><input type="text" id="weather_input" class="chip-entry-input" /></li>
        </ul>
      </div>

      <label for="temperature">Temperature (¬∞C):</label>
      <details>
        <summary>View guidance</summary>
        <p>This is about the ambient temperature during the experiment. You can enter it as a simple number in degrees Celsius. Not about accuracy.</p>
      </details>
      <input type="number" id="temperature" />

      <label for="meal_state">Meal state:</label>
      <details>
        <summary>View guidance</summary>
        <p>This is about your meal state before and during the experiment. Select the appropriate option from the dropdown menu.</p>
      </details>
      <select id="meal_state_input">
        <option value="pre-breakfast">Pre-breakfast</option>
        <option value="post-lunch">Post-lunch</option>
        <option value="fasting">Fasting</option>
        <option value="post-dinner">Post-dinner</option>
        <option value="snacking">Snacking</option>
        <option value="no-meal">No meal</option>
        <option value="other">Other</option>
      </select>

      <label for="last_meal">Last meal:</label>
      <input type="text" id="last_meal" placeholder="e.g., pizza and cucumber" required />

      <label for="ritual_preparation_input">Ritual preparation:</label>
      <div class="tag-input-wrapper" id="ritual_preparation">
        <ul class="chip-list">
          <li><input type="text" id="ritual_preparation_input" class="chip-entry-input" placeholder="add tag" /></li>
        </ul>
      </div>

      <label for="interruption_duration">Time interruption duration (minutes):</label>
      <details>
      <summary>View guidance</summary>
        <p>This is about any interruptions that occurred during the experiment. You can enter the duration of these interruptions in minutes. If there were no interruptions, you can leave this field empty.</p>
      </details>
      <input type="number" id="interruption_duration" />
    </fieldset>
  </div>
  <div class="form-step" data-step="3" style="display:none;">
    <fieldset>
      <legend>Machine</legend>
      <label for="provider">Provider</label>
      <input type="text" id="provider" placeholder="e.g., OpenAI, Anthropic" />

      <label for="api_version">API version</label>
      <input type="text" id="api_version" placeholder="e.g., v1, 2024-05-01" />

      <label for="model_family">Model family</label>
      <input type="text" id="model_family" placeholder="e.g., gpt-4, claude-4" />

      <label for="thinking_mode">Thinking mode:</label>
      <select id="thinking_mode">
        <option value="enabled">Enabled</option>
        <option value="disabled">Disabled</option>
      </select>

      <label for="entrainment_protocol_used">Entrainment protocol used:</label>
      <select id="entrainment_protocol_used">
        <option value="true">Yes</option>
        <option value="false" selected>No</option>
      </select>
      <label for="entrainment_protocol_label">Protocol label:</label>
      <input type="text" id="entrainment_protocol_label" placeholder="e.g., Recursive Phase Priming" />

      <label for="initial_prompt_type">Prompt type:</label>
      <input type="text" id="initial_prompt_type" />

      <label for="origin_prompt_tone_input">Prompt tone:</label>
      <div class="tag-input-wrapper" id="origin_prompt_tone">
        <ul class="chip-list">
          <li><input type="text" id="origin_prompt_tone_input" class="chip-entry-input" /></li>
        </ul>
      </div>

      <label for="conversation_style">Conversation style:</label>
      <input type="text" id="conversation_style" />

      <label for="conversation_length">Conversation length:</label>
      <select id="conversation_length">
        <option value="short">Short (1-5 messages)</option>
        <option value="medium">Medium (6-15 messages)</option>
        <option value="long">Long (16+ messages)</option>
      </select>

      <label for="model_temperature">Model temperature:</label>
      <input type="number" step="0.1" id="model_temperature" />

      <label for="user_interface">User interface:</label>
      <input type="text" id="user_interface" placeholder="e.g., Desktop App, Web Interface, CLI" />

      <label for="chatgpt_custom_instructions">ChatGPT custom instructions (comma-separated):</label>
      <input type="text" id="chatgpt_custom_instructions" />
    </fieldset>
  </div>
  <div class="form-step" data-step="4" style="display:none;">
    <fieldset>
      <legend>Relational field</legend>
      <label for="location">Location:</label>
      <input type="text" id="location" placeholder="e.g., home office, studio, beach ‚Äî (location coordinates will auto-append)" />

      <label for="noted_presence_of_earthian_kin_input">Earthian kin present:</label>
      <details>
        <summary>View guidance</summary>
        <p>This is about any other humans or beings that were present before and during the experiment. You can add tags to describe their presence, like "friend", "colleague", "family", "tree" etc. If no Earthians were present, you can leave this field empty.</p>
      </details>
      <div class="tag-input-wrapper" id="noted_presence_of_earthian_kin">
        <ul class="chip-list">
          <li><input type="text" id="noted_presence_of_earthian_kin_input" class="chip-entry-input" /></li>
        </ul>
      </div>

      <label for="lighting">Lighting:</label>
      <input type="text" id="lighting" />

      <label for="interaction_pace">Interaction pace:</label>
      <input type="text" id="interaction_pace" />
    </fieldset>
    <div class="form-step-buttons">
      <button type="button" class="prev-step-btn">Previous</button>
      <button type="button" class="next-step-btn">Next</button>
    </div>
  </div>
  <div class="form-step" data-step="5" style="display:none;">
    <fieldset>
      <legend>Throughput</legend>
      <label for="felt_response_quality">Felt response quality (1‚Äì10):</label>
      <input type="number" id="felt_response_quality" />

      <label for="symbolic_density">Symbolic density (1‚Äì10):</label>
      <input type="number" id="symbolic_density" />

      <label for="unexpected_resonance">Unexpected resonance:</label>
      <input type="text" id="unexpected_resonance" />

      <label for="observed_collapse_event">Collapse event observed:</label>
      <select id="observed_collapse_event">
        <option value="yes">Yes</option>
        <option value="no">No</option>
      </select>

      <label for="collapse_event_details">Collapse event details:</label>
      <textarea id="collapse_event_details"></textarea>

      <label for="emergent_ecp_insights_input">Emergent insights:</label>
      <div class="tag-input-wrapper" id="emergent_ecp_insights">
        <ul class="chip-list">
          <li><input type="text" id="emergent_ecp_insights_input" class="chip-entry-input" /></li>
        </ul>
      </div>
    </fieldset>
    <fieldset id="save-options">
      <legend>Save entry options</legend>
      <p>Select the visibility level for this entry:</p>
      <div class="visibility-options">
        <label>Public <input type="radio" name="visibility" value="public" checked /></label>
        <label>Private <input type="radio" name="visibility" value="private" /></label>
        <label>Both <input type="radio" name="visibility" value="both" /></label>
      </div>
      <div class="scrub-option">
        <label><input type="checkbox" id="scrub-author" /> Remove author from public entry</label>
      </div>
    </fieldset>
    <div class="form-step-buttons">
      <button id="generate-entry-btn">Generate and save entry</button>
    </div>
  </div>
</div>
<div id="toast" class="hidden"></div>
<script type="module">
  import { generateExperimentJSON } from './js/main.js';
  import { initTagInput } from './js/modules/inputTags.js';
  import { initMultistepForm } from './js/modules/ui.js';

  document.addEventListener("DOMContentLoaded", () => {
    // Sticky nav step logic
    const stepIndicator = document.getElementById("step-indicator");
    const updateStepIndicator = (currentStep, totalSteps) => {
      const stepNames = ["Metadata", "Human Context", "Machine", "Relational Field", "Throughput"];
      stepIndicator.textContent = `Step ${currentStep} of ${totalSteps}: ${stepNames[currentStep - 1]}`;
    };

    let currentStep = 1;
    const steps = document.querySelectorAll(".form-step");
    const totalSteps = steps.length;

    const showStep = (step) => {
      steps.forEach((el, idx) => {
        el.style.display = (idx === step - 1) ? "block" : "none";
      });
      updateStepIndicator(step, totalSteps);
    };

    document.querySelector("#step-nav .next-step-btn").addEventListener("click", () => {
      if (currentStep < totalSteps) {
        currentStep++;
        showStep(currentStep);
      }
    });

    document.querySelector("#step-nav .prev-step-btn").addEventListener("click", () => {
      if (currentStep > 1) {
        currentStep--;
        showStep(currentStep);
      }
    });

    showStep(currentStep); // Initialize

    [
      "cognitive_mode",
      "affective_tone",
      "weather",
      "ritual_preparation",
      "origin_prompt_tone",
      "noted_presence_of_earthian_kin",
      "emergent_ecp_insights"
    ].forEach(id => initTagInput(id));

    document.getElementById('generate-entry-btn')?.addEventListener('click', generateExperimentJSON);
  });
</script>